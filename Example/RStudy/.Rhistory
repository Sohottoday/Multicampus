write.csv(biz_d, file = "dataad.csv")
dataAll <- read.csv("c:/Sohottoday/data/biz_a.csv")
# R과 Oacle 연동
install.packages("DBI");
install.packages("RJDBC");
library(RJDBC)
library(DBI)
drv <- JDBC("oracle.jdbc.driver.OracleDriver","C:/Sohottoday/ojdbc6.jar")
conn <- dbConnect(drv,"jdbc:oracle:thin:@localhost:1521:xe","jdbctest","jdbctest")
conn
dbGetQuery(conn, "select count(*) AS cnt, SNT_UPTAE_NM
from biz_d
GROUP by SNT_UPTAE_NM
order by cnt desc")
dbGetQuery(conn, "select count(*),To_Char(DCB_YMD,'YYYY')
from biz_a
where DCB_YMD is not null
GROUP by To_Char(DCB_YMD,'YYYY')
order by count(*) desc")
국어 <- c(4,7,6,8,5,5,9,10,4,10);
수학 <- c(7,4,7,3,8,10,4,10,5,7)
par(mar=c(5,5,5,5), mfrow=c(1,1))
plot(국어, type="o", col="blue", ylim=c(0,10), axes=FALSE, ann=FALSE)
# x, y 축 추가하기
axis(1, at=1:10, lab=c("01","02","03","04", "05","06","07","08","09","10")) # x축 추가
axis(2, at=c(0,2,4,6,8,10))  # y축 추가
# 그래프 추가하고, 그래프에 박스 그리기
lines(수학, type="o", pch=16, lty=2, col="red")
dataAll <- read.csv("c:/Sohottoday/data/biz_a.csv")
# 전체 업종 비율
dbGetQuery(conn, "select snt_cob_nm, count(*) as cnt
from biz_a
group by snt_cob_nm
order by cnt desc");
library(RJDBC)
library(DBI)
drv <- JDBC("oracle.jdbc.driver.OracleDriver","C:/Sohottoday/ojdbc6.jar")
conn <- dbConnect(drv,"jdbc:oracle:thin:@localhost:1521:xe","jdbctest","jdbctest")
conn
# 전체 업종 비율
dbGetQuery(conn, "select snt_cob_nm, count(*) as cnt
from biz_a
group by snt_cob_nm
order by cnt desc");
# 전체 영업 시작 연도 비율
dbGetQuery(conn, "select yy, count(*) as cnt
from biz_a
where yy >= 1995 and yy < 2020
group by yy
order by yy desc");
#전체 폐업 연도 비율
dbGetQuery(conn, "select to_char(dcb_ymd, 'yyyy'), count(*) as cnt
from biz_a
where to_char(dcb_ymd, 'yyyy') >= 1995 and to_char(dcb_ymd, 'yyyy') < 2020
group by to_char(dcb_ymd, 'yyyy')
order by to_char(dcb_ymd, 'yyyy') desc");
# 전체 무슨 구에 가게가 많은가
dbGetQuery(conn, "select cgg_code, count(*) as cnt
from biz_a
group by cgg_code
order by cgg_code");
# 전체 무슨 구에 가게가 많은가
dbGetQuery(conn, "select cgg_code, count(*) as cnt
from biz_a
where cgg_code is not null
group by cgg_code
order by cgg_code");
# 전체 폐업 이유 비율
dbGetQuery(conn, "select dcb_gbn_nm, count(*) as cnt
from biz_a
where dcb_gbn_nm is not null
group by dcb_gbn_nm");
dbGetQuery(conn, "select snt_uptae_nm, count(*) as cnt
from biz_d
group by snt_uptae_nm
order by cnt desc");
# 전체 어떤 법을 어겼나
dbGetQuery(conn, "select bas_law, count(*) as cnt
from biz_d
where bas_law is not null
group by bas_law
order by cnt desc");
# 전체 어떤 처분을 받았나
dbGetQuery(conn, "select dispo_ctn_dt, count(*) as cnt
from biz_d
group by dispo_ctn_dt
order by cnt desc");
# 구별 업종 비율
dbGetQuery(conn, "select cgg_code, snt_cob_nm, count(*) as cnt
from biz_a
group by cgg_code,snt_cob_nm
order by cgg_code, cnt desc");
# 구별 영업 시작 연도 비율
dbGetQuery(conn, "select cgg_code, yy, count(*) as cnt
from biz_a
where yy >= 1995 and yy < 2020
group by cgg_code, yy
order by cgg_code, yy desc");
# 구별 폐업 연도 비율
dbGetQuery(conn, "select cgg_code, to_char(dcb_ymd, 'yyyy') as close_year, count(*) as cnt
from biz_a
where to_char(dcb_ymd, 'yyyy') >= 1995 and to_char(dcb_ymd, 'yyyy') < 2020
group by cgg_code, to_char(dcb_ymd, 'yyyy')
order by cgg_code, to_char(dcb_ymd, 'yyyy') desc");
# 구별 무슨동에 가게가 많은가?
dbGetQuery(conn, "select cgg_code, admdng_nm, count(*) as cnt
from biz_a
group by cgg_code, admdng_nm
having count(*) > 1
order by cgg_code, admdng_nm");
# 구별 행정처분 받은 업태 비율
dbGetQuery(conn, "select cgg_code, snt_uptae_nm, count(*) as cnt
from biz_d
group by cgg_code, snt_uptae_nm
order by cgg_code, cnt desc");
# 구별 어떤 법을 어겼는지?
dbGetQuery(conn, "select cgg_code, bas_law, count(*) as cnt
from biz_d
where bas_law is not null
group by cgg_code, bas_law
order by cgg_code");
# 구별 어떤 법을 어겼는지?
dbGetQuery(conn, "select cgg_code, bas_law, count(*) as cnt
from biz_d
where bas_law is not null
group by cgg_code, bas_law
order by cgg_code");
# 구별 어떤 처분을 받았는지?
dbGetQuery(conn, "select cgg_code, dispo_ctn, count(*) as cnt
from biz_d
group by cgg_code, dispo_ctn
order by cgg_code, cnt desc");
# 구별 적발 구분 비율
dbGetQuery(conn, "select cgg_code, insp_gbn_code, count(*) as cnt
from biz_d
where insp_gbn_code is not null
group by cgg_code, insp_gbn_code
order by cgg_code, cnt desc");
# 전체 업종 비율
dbGetQuery(conn, "select snt_cob_nm, count(*) as cnt
from biz_a
group by snt_cob_nm
order by cnt desc");
# 전체 업종 비율
upjongper <- dbGetQuery(conn, "select snt_cob_nm, count(*) as cnt
from biz_a
group by snt_cob_nm
order by cnt desc");
upjongper
upjongper
install.packages("ggplot2") # ggplot2 패키지 설치
install.packages("glue") # ggplot2 로드시 이 패키지 오류나면
library(ggplot2)
library(dplyr)
upjongper
ggplot(data = upjongper, aes(x = SNT_COB_NM)) + geom_bar()
ggplot(data = upjongper, aes(x = SNT_COB_NM)) + geom_bar() + coord_polar()
ggplot(data = upjongper, aes(x = SNT_COB_NM)) + geom_bar() + coord_polar(theta = "y")
head(upjongper)
ggplot(data = upjongper, aes(x = SNT_COB_NM, y=CNT, fill=Type)) + geom_bar() + coord_polar(theta = "y")
ggplot(data = upjongper, aes(x = SNT_COB_NM, y=CNT, fill=SNT_COB_NM)) + geom_bar() + coord_polar(theta = "y")
head(upjongper)
ggplot(data = head(upjongper), aes(x = SNT_COB_NM, y=CNT, fill=SNT_COB_NM)) + geom_bar() + coord_polar(theta = "y")
ggplot(data = head(upjongper), aes(x = SNT_COB_NM, fill=SNT_COB_NM)) + geom_bar() + coord_polar(theta = "y")
ggplot(data = head(upjongper), aes(x = SNT_COB_NM, fill=SNT_COB_NM)) + geom_bar() + coord_polar()
ggplot(data = head(upjongper), aes(x = "",y = SNT_COB_NM, fill=SNT_COB_NM)) + geom_bar() + coord_polar()
ggplot(data = head(upjongper), aes(y = SNT_COB_NM, fill=SNT_COB_NM)) + geom_bar() + coord_polar()
ggplot(data = head(upjongper), aes(y = SNT_COB_NM, fill=SNT_COB_NM)) + geom_bar() + coord_polar(theta = "y")
ggplot(data = head(upjongper), aes(x = SNT_COB_NM, fill=SNT_COB_NM)) + geom_bar() + coord_polar()
str(upjongper)
ggplot(data = head(upjongper), aes(x = "",y=cnt, fill=SNT_COB_NM)) + geom_bar() + coord_polar()
ggplot(data = head(upjongper), aes(x = "",y=CNT, fill=SNT_COB_NM)) + geom_bar() + coord_polar()
ggplot(data = head(upjongper), aes(x = "",y=CNT, fill=SNT_COB_NM)) + geom_bar() + coord_polar()
ggplot(data = head(upjongper), aes(x = "", y=CNT, fill=SNT_COB_NM)) + geom_bar(width = 1,stat = "identity") + coord_polar()
ggplot(data = head(upjongper), aes(x = "", y=CNT, fill=SNT_COB_NM)) + geom_bar(width = 1,stat = "identity") + coord_polar("y",start=0)
# 전체 영업 시작 연도 비율
dbGetQuery(conn, "select yy, count(*) as cnt
from biz_a
where yy >= 1995 and yy < 2020
group by yy
order by yy desc");
# 전체 영업 시작 연도 비율
startyear <- dbGetQuery(conn, "select yy, count(*) as cnt
from biz_a
where yy >= 1995 and yy < 2020
group by yy
order by yy desc");
ggplot(data = startyear, aes(x = "", y=CNT, fill=YY)) + geom_bar(width = 1,stat = "identity") + coord_polar("y",start=0)
ggplot(data = startyear, aes(x = "", y=CNT, fill=YY)) + geom_bar(width = 1,stat = "identity")
head(startyear,14)
ggplot(data = head(startyear,14), aes(x = "", y=CNT, fill=YY)) + geom_bar(width = 1,stat = "identity")# + coord_polar("y",start=0)
ggplot(data = head(startyear,14), aes(x = "", y=CNT, fill=YY)) + geom_bar(width = 1,stat = "identity") + coord_polar("y",start=0)
ggplot(data = head(startyear,14), aes(x = "", y=CNT, fill=YY)) + geom_bar(width = 1,stat = "identity") + coord_polar("y",start=0) + theme_classic()
ggplot(data = head(startyear,14), aes(x = "", y=CNT, fill=YY)) + geom_bar(width = 1,stat = "identity") + coord_polar("y",start=0) + scale_fill_brewer(palette = "Rainbow")
ggplot(data = head(startyear,12), aes(x = "", y=CNT, fill=YY)) + geom_bar(width = 1,stat = "identity") + coord_polar("y",start=0)
ggplot(data = head(startyear,12), aes(x = "", y=CNT, fill=YY)) + geom_bar(width = 1,stat = "identity") + coord_polar("y",start=0) + scale_fill_brewer(palette = "Rainbow")
ggplot(data = head(upjongper), aes(x = "", y=CNT, fill=SNT_COB_NM)) + geom_bar(width = 1,stat = "identity") + coord_polar("y",start=0)
ggplot(data = head(startyear,12), aes(x = "", y=CNT, fill=YY)) + geom_bar(width = 1,stat = "identity") + coord_polar("y",start=0) + scale_fill_brewer(palette = "Rainbow")
ggplot(data = head(startyear,12), aes(x = "", y=CNT, fill=YY)) + geom_bar(width = 1,stat = "identity") + coord_polar("y",start=0) + scale_fill_brewer()
ggplot(data = head(startyear,12), aes(x = "", y=CNT, fill=YY)) + geom_bar(width = 1,stat = "identity") + coord_polar("y",start=0) + scale_fill_brewer(rainbow())
ggplot(data = head(startyear,12), aes(x = "", y=CNT, fill=YY)) + geom_bar(width = 1,stat = "identity") + coord_polar("y",start=0) + scale_fill_brewer(rainbow(12))
ggplot(data = head(startyear,12), aes(x = "", y=CNT, fill=YY)) + geom_bar(width = 1,stat = "identity") + coord_polar("y",start=0)
ggplot(startyear, aes(x=YY, y=CNT)) + geom_line(size=2, linetype = "dotdash")
ggplot(startyear, aes(x=YY, y=CNT)) + geom_line(size=2, linetype = 3)
ggplot(startyear, aes(x=YY, y=CNT)) + geom_line(size=2, linetype = 1)
startyear
#전체 폐업 연도 비율
closeyear <- dbGetQuery(conn, "select to_char(dcb_ymd, 'yyyy'), count(*) as cnt
from biz_a
where to_char(dcb_ymd, 'yyyy') >= 1995 and to_char(dcb_ymd, 'yyyy') < 2020
group by to_char(dcb_ymd, 'yyyy')
order by to_char(dcb_ymd, 'yyyy') desc");
closeyear
#전체 폐업 연도 비율
closeyear <- dbGetQuery(conn, "select to_char(dcb_ymd, 'yyyy') as closeyear, count(*) as cnt
from biz_a
where to_char(dcb_ymd, 'yyyy') >= 1995 and to_char(dcb_ymd, 'yyyy') < 2020
group by to_char(dcb_ymd, 'yyyy')
order by to_char(dcb_ymd, 'yyyy') desc");
closeyear
ggplot(closeyear, aes(x=closeyear, y=CNT)) + geom_line(size=2, linetype = 1)
#전체 폐업 연도 비율
closeyear <- dbGetQuery(conn, "select to_char(dcb_ymd, 'yyyy') as close_year, count(*) as cnt
from biz_a
where to_char(dcb_ymd, 'yyyy') >= 1995 and to_char(dcb_ymd, 'yyyy') < 2020
group by to_char(dcb_ymd, 'yyyy')
order by to_char(dcb_ymd, 'yyyy') desc");
ggplot(closeyear, aes(x=close_year, y=CNT)) + geom_line(size=2, linetype = 1)
ggplot(closeyear, aes(x=CLOSE_YEAR, y=CNT)) + geom_line(size=2, linetype = 1)
ggplot(closeyear, aes(x=CLOSE_YEAR, y=CNT)) + geom_line(size=2, linetype = 1)
ggplot(closeyear, aes(x=as.numeric(CLOSE_YEAR), y=CNT)) + geom_line(size=2, linetype = 1)
styr <- ggplot(startyear, aes(x=YY, y=CNT))
# 전체 무슨 구에 가게가 많은가
dbGetQuery(conn, "select cgg_code, count(*) as cnt
from biz_a
where cgg_code is not null
group by cgg_code
order by cgg_code");
# 전체 무슨 구에 가게가 많은가
gucnt <- dbGetQuery(conn, "select cgg_code, count(*) as cnt
from biz_a
where cgg_code is not null
group by cgg_code
order by cgg_code");
ggplot(gucnt, aes(x=gucnt, y=cnt)) + geom_bar(aes(fill=gucnt), alpha=1.0)
ggplot(gucnt, aes(x=CGG_CODE, y=CNT)) + geom_bar(aes(fill=CGG_CODE), alpha=1.0)
ggplot(gucnt, aes(x=CGG_CODE) + geom_bar(aes(fill=CGG_CODE), alpha=1.0)
# 전체 폐업 이유 비율
dbGetQuery(conn, "select dcb_gbn_nm, count(*) as cnt
from biz_a
where dcb_gbn_nm is not null
group by dcb_gbn_nm");
ggplot(gucnt, aes(x=CGG_CODE)) + geom_bar(aes(fill=CGG_CODE), alpha=1.0);
ggplot(gucnt, aes(x="",Y=CGG_CODE)) + geom_bar(aes(fill=CGG_CODE), alpha=1.0);
ggplot(gucnt, aes(x=CGG_CODE,Y=CNT,FILL=CGG_CODE)) + geom_bar();
ggplot(gucnt, aes(x=CGG_CODE,Y=CNT,FILL=CGG_CODE)) + geom_bar(STAT='identity');
gucnt
ggplot(gucnt, aes(x=CGG_CODE,y=CNT,fill=CGG_CODE)) + geom_bar(STAT='identity');
ggplot(gucnt, aes(x=CGG_CODE,y=CNT,fill=CGG_CODE)) + geom_bar(STAT='identity');
ggplot(gucnt, aes(x=CGG_CODE,y=CNT,fill=CGG_CODE)) + geom_bar(stat = 'identity');
ggplot(gucnt, aes(x=CGG_CODE,y=CNT,fill=cnt)) + geom_bar(stat = 'identity');
ggplot(gucnt, aes(x=CGG_CODE,y=CNT,fill=CNT)) + geom_bar(stat = 'identity');
# 전체 폐업 이유 비율
dbGetQuery(conn, "select dcb_gbn_nm, count(*) as cnt
from biz_a
where dcb_gbn_nm is not null
group by dcb_gbn_nm");
ggplot(data = head(upjongper), aes(x = "", y=CNT, fill=SNT_COB_NM)) + geom_bar(width = 1,stat = "identity") + coord_polar("y",start=0)
# 전체 폐업 이유 비율
closewhy <- dbGetQuery(conn, "select dcb_gbn_nm, count(*) as cnt
from biz_a
where dcb_gbn_nm is not null
group by dcb_gbn_nm");
ggplot(data = closewhy, aes(x = "", y=CNT/498663, fill=DCB_GBN_NM)) + geom_bar(width = 1,stat = "identity") + coord_polar("y",start=0)
# 전체 행정처분 받은 업태 비율
dbGetQuery(conn, "select snt_uptae_nm, count(*) as cnt
from biz_d
group by snt_uptae_nm
order by cnt desc");
# 전체 행정처분 받은 업태 비율
dbGetQuery(conn, "select snt_uptae_nm, count(*) as cnt
from biz_d
where snt_uptae_nm is not null
group by snt_uptae_nm
order by cnt desc");
head(uptae,12)
# 전체 행정처분 받은 업태 비율
uptae <- dbGetQuery(conn, "select snt_uptae_nm, count(*) as cnt
from biz_d
where snt_uptae_nm is not null
group by snt_uptae_nm
order by cnt desc");
head(uptae,12)
ggplot(data = head(uptae,12), aes(x = "", y=CNT/12452, fill=SNT_UPTAE_NM)) + geom_bar(width = 1,stat = "identity") + coord_polar("y",start=0)
# 전체 어떤 법을 어겼나
dbGetQuery(conn, "select bas_law_clear, count(*) as cnt
from biz_d
where bas_law_clear is not null
group by bas_law_clear
order by cnt desc");
# 전체 어떤 법을 어겼나
dbGetQuery(conn, "select bas_law_clean, count(*) as cnt
from biz_d
where bas_law_clean is not null
group by bas_law_clean
order by cnt desc");
ggplot(closeyear, aes(x=as.numeric(CLOSE_YEAR), y=CNT)) + geom_line(size=2, linetype = 1)
ggplot(closeyear, aes(x=as.numeric(CLOSE_YEAR), y=CNT)) + geom_line(color = "blue",size=2, linetype = 1)
ggplot(closeyear, aes(x=as.numeric(CLOSE_YEAR), y=CNT)) + geom_line(color = "green",size=2, linetype = 1)
ggplot(closeyear, aes(x=as.numeric(CLOSE_YEAR), y=CNT)) + geom_line(color = "sky",size=2, linetype = 1)
ggplot(closeyear, aes(x=as.numeric(CLOSE_YEAR), y=CNT)) + geom_line(color = "Fuchsia",size=2, linetype = 1)
ggplot(closeyear, aes(x=as.numeric(CLOSE_YEAR), y=CNT)) + geom_line(color = "#ff5050",size=2, linetype = 1)
ggplot(startyear, aes(x=YY, y=CNT)) + geom_line(color = "#3366ff",size=2, linetype = 1)
dataapt <- read.csv("c:/Sohottoday/data/totalapt.csv")
write.csv(dataapt, file = "ttapt.csv");
write.csv(dataapt, file = "ttapt.csv", fileEncoding = "UTF-8");
write.csv(dataapt, file = "ttapt.csv", fileEncoding = "UTF-8");
dbGetQuery(conn, "select to_char(DCB_YMD,'YYYY') - to_char(VIOR_YMD,'YYYY') AS upsoyear, cnt
from (select DISTINCT biz_c.VIOR_YMD, biz_c.UPSO_NM, biz_c.SITE_ADDR,biz_c.SITE_STDT,biz_c.DCB_YMD,cnt
from
(select biz_a.UPSO_NM,biz_a.SITE_ADDR,biz_a.SITE_STDT,nvl(biz_a.DCB_YMD,Sysdate + (INTERVAL '10' YEAR)) as DCB_YMD,biz_d.VIOR_YMD
from (SELECT UPSO_NM, SITE_ADDR,VIOR_YMD
FROM biz_d
where DISPO_CTN not like '%폐쇠%' and DISPO_CTN not like '%폐쇄%') biz_d inner join biz_a
on biz_a.upso_nm = biz_d.upso_nm and biz_a.SITE_ADDR = biz_d.SITE_ADDR) biz_c
inner join
(select biz_a.UPSO_NM,biz_a.SITE_ADDR,count(*) AS cnt
from (SELECT UPSO_NM, SITE_ADDR,VIOR_YMD
FROM biz_d
where DISPO_CTN not like '%폐쇠%' and DISPO_CTN not like '%폐쇄%') biz_d inner join biz_a
on biz_a.upso_nm = biz_d.upso_nm and biz_a.SITE_ADDR = biz_d.SITE_ADDR
group by biz_a.UPSO_NM,biz_a.SITE_ADDR) biz_d
on biz_c.UPSO_NM = biz_d.upso_nm
ORDER by VIOR_YMD desc)
where cnt<6 and to_char(DCB_YMD,'YYYY') - to_char(VIOR_YMD,'YYYY') >= 0");
library(RJDBC)
library(DBI)
dbGetQuery(conn, "select to_char(DCB_YMD,'YYYY') - to_char(VIOR_YMD,'YYYY') AS upsoyear, cnt
from (select DISTINCT biz_c.VIOR_YMD, biz_c.UPSO_NM, biz_c.SITE_ADDR,biz_c.SITE_STDT,biz_c.DCB_YMD,cnt
from
(select biz_a.UPSO_NM,biz_a.SITE_ADDR,biz_a.SITE_STDT,nvl(biz_a.DCB_YMD,Sysdate + (INTERVAL '10' YEAR)) as DCB_YMD,biz_d.VIOR_YMD
from (SELECT UPSO_NM, SITE_ADDR,VIOR_YMD
FROM biz_d
where DISPO_CTN not like '%폐쇠%' and DISPO_CTN not like '%폐쇄%') biz_d inner join biz_a
on biz_a.upso_nm = biz_d.upso_nm and biz_a.SITE_ADDR = biz_d.SITE_ADDR) biz_c
inner join
(select biz_a.UPSO_NM,biz_a.SITE_ADDR,count(*) AS cnt
from (SELECT UPSO_NM, SITE_ADDR,VIOR_YMD
FROM biz_d
where DISPO_CTN not like '%폐쇠%' and DISPO_CTN not like '%폐쇄%') biz_d inner join biz_a
on biz_a.upso_nm = biz_d.upso_nm and biz_a.SITE_ADDR = biz_d.SITE_ADDR
group by biz_a.UPSO_NM,biz_a.SITE_ADDR) biz_d
on biz_c.UPSO_NM = biz_d.upso_nm
ORDER by VIOR_YMD desc)
where cnt<6 and to_char(DCB_YMD,'YYYY') - to_char(VIOR_YMD,'YYYY') >= 0");
test <- dbGetQuery(conn, "select to_char(DCB_YMD,'YYYY') - to_char(VIOR_YMD,'YYYY') AS upsoyear, cnt
from (select DISTINCT biz_c.VIOR_YMD, biz_c.UPSO_NM, biz_c.SITE_ADDR,biz_c.SITE_STDT,biz_c.DCB_YMD,cnt
from
(select biz_a.UPSO_NM,biz_a.SITE_ADDR,biz_a.SITE_STDT,nvl(biz_a.DCB_YMD,Sysdate + (INTERVAL '10' YEAR)) as DCB_YMD,biz_d.VIOR_YMD
from (SELECT UPSO_NM, SITE_ADDR,VIOR_YMD
FROM biz_d
where DISPO_CTN not like '%폐쇠%' and DISPO_CTN not like '%폐쇄%') biz_d inner join biz_a
on biz_a.upso_nm = biz_d.upso_nm and biz_a.SITE_ADDR = biz_d.SITE_ADDR) biz_c
inner join
(select biz_a.UPSO_NM,biz_a.SITE_ADDR,count(*) AS cnt
from (SELECT UPSO_NM, SITE_ADDR,VIOR_YMD
FROM biz_d
where DISPO_CTN not like '%폐쇠%' and DISPO_CTN not like '%폐쇄%') biz_d inner join biz_a
on biz_a.upso_nm = biz_d.upso_nm and biz_a.SITE_ADDR = biz_d.SITE_ADDR
group by biz_a.UPSO_NM,biz_a.SITE_ADDR) biz_d
on biz_c.UPSO_NM = biz_d.upso_nm
ORDER by VIOR_YMD desc)
where cnt<6 and to_char(DCB_YMD,'YYYY') - to_char(VIOR_YMD,'YYYY') >= 0");
test <- dbGetQuery(conn, "select to_char(DCB_YMD,'YYYY') - to_char(VIOR_YMD,'YYYY') AS upsoyear, cnt
from (select DISTINCT biz_c.VIOR_YMD, biz_c.UPSO_NM, biz_c.SITE_ADDR,biz_c.SITE_STDT,biz_c.DCB_YMD,cnt
from
(select biz_a.UPSO_NM,biz_a.SITE_ADDR,biz_a.SITE_STDT,nvl(biz_a.DCB_YMD,Sysdate + (INTERVAL '10' YEAR)) as DCB_YMD,biz_d.VIOR_YMD
from (SELECT UPSO_NM, SITE_ADDR,VIOR_YMD
FROM biz_d
where DISPO_CTN not like '%폐쇠%' and DISPO_CTN not like '%폐쇄%') biz_d inner join biz_a
on biz_a.upso_nm = biz_d.upso_nm and biz_a.SITE_ADDR = biz_d.SITE_ADDR) biz_c
inner join
(select biz_a.UPSO_NM,biz_a.SITE_ADDR,count(*) AS cnt
from (SELECT UPSO_NM, SITE_ADDR,VIOR_YMD
FROM biz_d
where DISPO_CTN not like '%폐쇠%' and DISPO_CTN not like '%폐쇄%') biz_d inner join biz_a
on biz_a.upso_nm = biz_d.upso_nm and biz_a.SITE_ADDR = biz_d.SITE_ADDR
group by biz_a.UPSO_NM,biz_a.SITE_ADDR) biz_d
on biz_c.UPSO_NM = biz_d.upso_nm
ORDER by VIOR_YMD desc)
where cnt<6 and to_char(DCB_YMD,'YYYY') - to_char(VIOR_YMD,'YYYY') >= 0;")
library(DBI)
test <- dbGetQuery(conn, "select to_char(DCB_YMD,'YYYY') - to_char(VIOR_YMD,'YYYY') AS upsoyear, cnt
from (select DISTINCT biz_c.VIOR_YMD, biz_c.UPSO_NM, biz_c.SITE_ADDR,biz_c.SITE_STDT,biz_c.DCB_YMD,cnt
from
(select biz_a.UPSO_NM,biz_a.SITE_ADDR,biz_a.SITE_STDT,nvl(biz_a.DCB_YMD,Sysdate + (INTERVAL '10' YEAR)) as DCB_YMD,biz_d.VIOR_YMD
from (SELECT UPSO_NM, SITE_ADDR,VIOR_YMD
FROM biz_d
where DISPO_CTN not like '%폐쇠%' and DISPO_CTN not like '%폐쇄%') biz_d inner join biz_a
on biz_a.upso_nm = biz_d.upso_nm and biz_a.SITE_ADDR = biz_d.SITE_ADDR) biz_c
inner join
(select biz_a.UPSO_NM,biz_a.SITE_ADDR,count(*) AS cnt
from (SELECT UPSO_NM, SITE_ADDR,VIOR_YMD
FROM biz_d
where DISPO_CTN not like '%폐쇠%' and DISPO_CTN not like '%폐쇄%') biz_d inner join biz_a
on biz_a.upso_nm = biz_d.upso_nm and biz_a.SITE_ADDR = biz_d.SITE_ADDR
group by biz_a.UPSO_NM,biz_a.SITE_ADDR) biz_d
on biz_c.UPSO_NM = biz_d.upso_nm
ORDER by VIOR_YMD desc)
where cnt<6 and to_char(DCB_YMD,'YYYY') - to_char(VIOR_YMD,'YYYY') >= 0;")
library(RJDBC)
test <- dbGetQuery(conn, "select to_char(DCB_YMD,'YYYY') - to_char(VIOR_YMD,'YYYY') AS upsoyear, cnt
from (select DISTINCT biz_c.VIOR_YMD, biz_c.UPSO_NM, biz_c.SITE_ADDR,biz_c.SITE_STDT,biz_c.DCB_YMD,cnt
from
(select biz_a.UPSO_NM,biz_a.SITE_ADDR,biz_a.SITE_STDT,nvl(biz_a.DCB_YMD,Sysdate + (INTERVAL '10' YEAR)) as DCB_YMD,biz_d.VIOR_YMD
from (SELECT UPSO_NM, SITE_ADDR,VIOR_YMD
FROM biz_d
where DISPO_CTN not like '%폐쇠%' and DISPO_CTN not like '%폐쇄%') biz_d inner join biz_a
on biz_a.upso_nm = biz_d.upso_nm and biz_a.SITE_ADDR = biz_d.SITE_ADDR) biz_c
inner join
(select biz_a.UPSO_NM,biz_a.SITE_ADDR,count(*) AS cnt
from (SELECT UPSO_NM, SITE_ADDR,VIOR_YMD
FROM biz_d
where DISPO_CTN not like '%폐쇠%' and DISPO_CTN not like '%폐쇄%') biz_d inner join biz_a
on biz_a.upso_nm = biz_d.upso_nm and biz_a.SITE_ADDR = biz_d.SITE_ADDR
group by biz_a.UPSO_NM,biz_a.SITE_ADDR) biz_d
on biz_c.UPSO_NM = biz_d.upso_nm
ORDER by VIOR_YMD desc)
where cnt<6 and to_char(DCB_YMD,'YYYY') - to_char(VIOR_YMD,'YYYY') >= 0;")
install.packages("RJDBC")
.jinit()
library(DBI)
library(RJDBC)
test <- dbGetQuery(conn, "select to_char(DCB_YMD,'YYYY') - to_char(VIOR_YMD,'YYYY') AS upsoyear, cnt
from (select DISTINCT biz_c.VIOR_YMD, biz_c.UPSO_NM, biz_c.SITE_ADDR,biz_c.SITE_STDT,biz_c.DCB_YMD,cnt
from
(select biz_a.UPSO_NM,biz_a.SITE_ADDR,biz_a.SITE_STDT,nvl(biz_a.DCB_YMD,Sysdate + (INTERVAL '10' YEAR)) as DCB_YMD,biz_d.VIOR_YMD
from (SELECT UPSO_NM, SITE_ADDR,VIOR_YMD
FROM biz_d
where DISPO_CTN not like '%폐쇠%' and DISPO_CTN not like '%폐쇄%') biz_d inner join biz_a
on biz_a.upso_nm = biz_d.upso_nm and biz_a.SITE_ADDR = biz_d.SITE_ADDR) biz_c
inner join
(select biz_a.UPSO_NM,biz_a.SITE_ADDR,count(*) AS cnt
from (SELECT UPSO_NM, SITE_ADDR,VIOR_YMD
FROM biz_d
where DISPO_CTN not like '%폐쇠%' and DISPO_CTN not like '%폐쇄%') biz_d inner join biz_a
on biz_a.upso_nm = biz_d.upso_nm and biz_a.SITE_ADDR = biz_d.SITE_ADDR
group by biz_a.UPSO_NM,biz_a.SITE_ADDR) biz_d
on biz_c.UPSO_NM = biz_d.upso_nm
ORDER by VIOR_YMD desc)
where cnt<6 and to_char(DCB_YMD,'YYYY') - to_char(VIOR_YMD,'YYYY') >= 0;")
drv <- JDBC("oracle.jdbc.driver.OracleDriver","C:/Sohottoday/ojdbc6.jar")
conn <- dbConnect(drv,"jdbc:oracle:thin:@localhost:1521:xe","jdbctest","jdbctest")
conn
test <- dbGetQuery(conn, "select to_char(DCB_YMD,'YYYY') - to_char(VIOR_YMD,'YYYY') AS upsoyear, cnt
test <- dbGetQuery(conn, "select to_char(DCB_YMD,'YYYY') - to_char(VIOR_YMD,'YYYY') AS upsoyear, cnt
from (select DISTINCT biz_c.VIOR_YMD, biz_c.UPSO_NM, biz_c.SITE_ADDR,biz_c.SITE_STDT,biz_c.DCB_YMD,cnt
from
(select biz_a.UPSO_NM,biz_a.SITE_ADDR,biz_a.SITE_STDT,nvl(biz_a.DCB_YMD,Sysdate + (INTERVAL '10' YEAR)) as DCB_YMD,biz_d.VIOR_YMD
from (SELECT UPSO_NM, SITE_ADDR,VIOR_YMD
FROM biz_d
where DISPO_CTN not like '%폐쇠%' and DISPO_CTN not like '%폐쇄%') biz_d inner join biz_a
on biz_a.upso_nm = biz_d.upso_nm and biz_a.SITE_ADDR = biz_d.SITE_ADDR) biz_c
inner join
(select biz_a.UPSO_NM,biz_a.SITE_ADDR,count(*) AS cnt
from (SELECT UPSO_NM, SITE_ADDR,VIOR_YMD
FROM biz_d
where DISPO_CTN not like '%폐쇠%' and DISPO_CTN not like '%폐쇄%') biz_d inner join biz_a
on biz_a.upso_nm = biz_d.upso_nm and biz_a.SITE_ADDR = biz_d.SITE_ADDR
group by biz_a.UPSO_NM,biz_a.SITE_ADDR) biz_d
on biz_c.UPSO_NM = biz_d.upso_nm
ORDER by VIOR_YMD desc)
where cnt<6 and to_char(DCB_YMD,'YYYY') - to_char(VIOR_YMD,'YYYY') >= 0;")
test <- dbGetQuery(conn, "select to_char(DCB_YMD,'YYYY') - to_char(VIOR_YMD,'YYYY') AS upsoyear, cnt
from (select DISTINCT biz_c.VIOR_YMD, biz_c.UPSO_NM, biz_c.SITE_ADDR,biz_c.SITE_STDT,biz_c.DCB_YMD,cnt
from
(select biz_a.UPSO_NM,biz_a.SITE_ADDR,biz_a.SITE_STDT,nvl(biz_a.DCB_YMD,Sysdate + (INTERVAL '10' YEAR)) as DCB_YMD,biz_d.VIOR_YMD
from (SELECT UPSO_NM, SITE_ADDR,VIOR_YMD
FROM biz_d
where DISPO_CTN not like '%폐쇠%' and DISPO_CTN not like '%폐쇄%') biz_d inner join biz_a
on biz_a.upso_nm = biz_d.upso_nm and biz_a.SITE_ADDR = biz_d.SITE_ADDR) biz_c
inner join
(select biz_a.UPSO_NM,biz_a.SITE_ADDR,count(*) AS cnt
from (SELECT UPSO_NM, SITE_ADDR,VIOR_YMD
FROM biz_d
where DISPO_CTN not like '%폐쇠%' and DISPO_CTN not like '%폐쇄%') biz_d inner join biz_a
on biz_a.upso_nm = biz_d.upso_nm and biz_a.SITE_ADDR = biz_d.SITE_ADDR
group by biz_a.UPSO_NM,biz_a.SITE_ADDR) biz_d
on biz_c.UPSO_NM = biz_d.upso_nm
ORDER by VIOR_YMD desc)
where cnt<6 and to_char(DCB_YMD,'YYYY') - to_char(VIOR_YMD,'YYYY') >= 0;")
test
test <- dbGetQuery(conn, "select to_char(DCB_YMD,'YYYY') - to_char(VIOR_YMD,'YYYY') AS upsoyear, cnt
from (select DISTINCT biz_c.VIOR_YMD, biz_c.UPSO_NM, biz_c.SITE_ADDR,biz_c.SITE_STDT,biz_c.DCB_YMD,cnt
from
(select biz_a.UPSO_NM,biz_a.SITE_ADDR,biz_a.SITE_STDT,nvl(biz_a.DCB_YMD,Sysdate + (INTERVAL '10' YEAR)) as DCB_YMD,biz_d.VIOR_YMD
from (SELECT UPSO_NM, SITE_ADDR,VIOR_YMD
FROM biz_d
where DISPO_CTN not like '%폐쇠%' and DISPO_CTN not like '%폐쇄%') biz_d inner join biz_a
on biz_a.upso_nm = biz_d.upso_nm and biz_a.SITE_ADDR = biz_d.SITE_ADDR) biz_c
inner join
(select biz_a.UPSO_NM,biz_a.SITE_ADDR,count(*) AS cnt
from (SELECT UPSO_NM, SITE_ADDR,VIOR_YMD
FROM biz_d
where DISPO_CTN not like '%폐쇠%' and DISPO_CTN not like '%폐쇄%') biz_d inner join biz_a
on biz_a.upso_nm = biz_d.upso_nm and biz_a.SITE_ADDR = biz_d.SITE_ADDR
group by biz_a.UPSO_NM,biz_a.SITE_ADDR) biz_d
on biz_c.UPSO_NM = biz_d.upso_nm
ORDER by VIOR_YMD desc)
where cnt<6 and to_char(DCB_YMD,'YYYY') - to_char(VIOR_YMD,'YYYY') >= 0")
test
write.csv(test, file = "dfdf.csv", fileEncoding = "UTF-8");
